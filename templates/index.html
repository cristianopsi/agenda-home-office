<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>{{ titulo }}</title>
    <link rel="manifest" href="/static/manifest.json">
    <meta name="theme-color" content="#1976d2">

    <style>
        body {
            font-family: Arial, sans-serif;
        }

        fieldset {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 12px;
        }

        legend {
            font-weight: bold;
        }

        .mes {
            margin-top: 30px;
        }

        .titulo-mes {
            font-size: 1.2em;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .calendario {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
        }

        .header {
            font-weight: bold;
            text-align: center;
            padding: 5px;
        }

        .dia {
            min-height: 80px;
            border: 1px solid #ddd;
            padding: 4px;
            cursor: pointer;
        }

        .dia.vazio {
            background-color: #f5f5f5;
            cursor: default;
        }

        .home {
            background-color: #ffe88c;
        }

        .presencial {
            background-color: #9ecbff;
        }

        .label {
            font-size: 0.9em;
        }
    </style>
</head>

<body>

<h1>{{ titulo }}</h1>

<form method="post">

    <fieldset>
        <legend>Planejamento semanal ‚Äì Presencial</legend>
        <label><input type="checkbox" name="presencial" value="0"> Seg</label>
        <label><input type="checkbox" name="presencial" value="1"> Ter</label>
        <label><input type="checkbox" name="presencial" value="2"> Qua</label>
        <label><input type="checkbox" name="presencial" value="3"> Qui</label>
        <label><input type="checkbox" name="presencial" value="4"> Sex</label>
    </fieldset>

    <fieldset>
        <legend>Planejamento semanal ‚Äì Home Office</legend>
        <label><input type="checkbox" name="home" value="0"> Seg</label>
        <label><input type="checkbox" name="home" value="1"> Ter</label>
        <label><input type="checkbox" name="home" value="2"> Qua</label>
        <label><input type="checkbox" name="home" value="3"> Qui</label>
        <label><input type="checkbox" name="home" value="4"> Sex</label>
    </fieldset>

    

    <fieldset>
        <legend>Configura√ß√µes</legend>

        <label>
            <input type="checkbox" name="inverter">
            Inverter semana seguinte
        </label>

        <br><br>

        <label>Aplicar para:</label>
        <select name="periodo">
            <option value="MES">M√™s</option>
            <option value="SEMESTRE">Semestre</option>
            <option value="ANO">Ano</option>
        </select>

        <label>M√™s:</label>
        <select name="mes">
            {% for m in range(1,13) %}
                <option value="{{ m }}" {% if m == mes %}selected{% endif %}>
                    {{ meses[m] }}
                </option>
            {% endfor %}
        </select>

        <label>Ano:</label>
        <select name="ano">
            {% for a in range(ano-2, ano+3) %}
                <option value="{{ a }}" {% if a == ano %}selected{% endif %}>
                    {{ a }}
                </option>
            {% endfor %}
        </select>
    </fieldset>

    <button type="submit">Aplicar</button>
    <a href="/exportar?ano={{ ano }}&mes={{ mes }}&periodo={{ periodo }}"
    target="_blank"
    rel="noopener noreferrer"
    style="margin-left:15px">
    üìÖ Exportar agenda (ICS)
    </a>


</form>

{% for cal in calendarios %}
<div class="mes">
    <div class="titulo-mes">{{ cal.nome_mes }} / {{ ano }}</div>

    <div class="calendario">
        <div class="header">Seg</div>
        <div class="header">Ter</div>
        <div class="header">Qua</div>
        <div class="header">Qui</div>
        <div class="header">Sex</div>
        <div class="header">S√°b</div>
        <div class="header">Dom</div>

        {% for semana in cal.semanas %}
            {% for d in semana %}
                {% if d %}
                    <div class="dia {{ d.modalidade|lower if d.modalidade }}"
                         data-data="{{ d.data }}"
                         onclick="editarDia(this)">
                        <strong>{{ d.dia }}</strong>

                        {% if d.modalidade == "HOME" %}
                            <div class="label">üè† Home Office</div>
                        {% elif d.modalidade == "PRESENCIAL" %}
                            <div class="label">üè¢ Presencial</div>
                        {% endif %}

                    </div>
                {% else %}
                    <div class="dia vazio"></div>
                {% endif %}
            {% endfor %}
        {% endfor %}
    </div>
</div>
{% endfor %}

<script>
function editarDia(el) {

    if (!el.dataset.data) {
        return; // bloqueia s√°bado/domingo
    }

    const data = el.dataset.data;
    let modalidade = null;

    if (el.classList.contains("home")) {
        modalidade = "PRESENCIAL";
    } else if (el.classList.contains("presencial")) {
        modalidade = null;
    } else {
        modalidade = "HOME";
    }

    fetch("/editar-dia", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            data: data,
            modalidade: modalidade
        })
    })
    .then(() => location.reload());
}
</script>
    <script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("/static/service-worker.js");
}
</script>

</body>
</html>
